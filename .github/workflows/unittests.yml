name: Python Tests

on:
  push:
    branches: [ main, task-* ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'  # Changed from 3.9 to 3.10 for better compatibility
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest
    
    - name: Run basic syntax check
      run: |
        python -m py_compile src/__init__.py
        python -m py_compile scripts/__init__.py
        python -m py_compile tests/__init__.py
        echo "✅ All Python files compiled successfully"
    
    - name: Test data loading
      run: |
        python -c "
        import pandas as pd
        try:
            # Test if we can import our main libraries
            import pandas as pd
            import numpy as np
            import matplotlib.pyplot as plt
            print('✅ All main libraries import successfully')
            
            # Test data directory structure
            import os
            if os.path.exists('data'):
                print('✅ Data directory exists')
            else:
                print('⚠️ Data directory not found')
                
        except Exception as e:
            print(f'❌ Error: {e}')
            exit(1)
        "
    
    - name: Notebook validation
      run: |
        python -c "
        import os
        notebooks = [f for f in os.listdir('notebooks') if f.endswith('.ipynb')]
        if notebooks:
            print(f'✅ Found {len(notebooks)} notebooks: {notebooks}')
        else:
            print('⚠️ No notebooks found')
        "